package game.engine;
import java.awt.*;
import java.util.*;
import java.util.List;
import javax.swing.*;

public class Game extends JFrame
{
	private Scene activeScene;
	private List<Scene> scenes = new ArrayList<Scene>();

	private long startTime;
	private boolean isRunning = true;
	private static final long serialVersionUID = 1L;
	private String title;
	public Insets insets;

	public Game(String title, int width, int height)
	{
		this.title = title;
		Screen.width = width;
		Screen.height = height;
	}

	public void run()
	{
		initialize();
		runFixedUpdate();
		runUpdate();
		setVisible(false);
	}

	public void runUpdate()
	{
		while(isRunning) 
		{
			long time = System.currentTimeMillis();
			Time.time = time - startTime;

			update();
			draw();

			Time.deltaTime = System.currentTimeMillis() - time;
		}
	}

	void runFixedUpdate()
	{
		Thread loop = new Thread()
		{
			public void run()
			{
				while(isRunning) 
				{
					long time = System.currentTimeMillis();
					Time.fixedTime = time - startTime;

					fixedUpdate();

					long delta = System.currentTimeMillis() - time;

					try
					{
						Thread.sleep(20 - delta);
						Time.deltaFixedTime = System.currentTimeMillis() - time;
					}
					catch(Exception e) {}
				}
			}
		};
		loop.start();
	} 

	void initialize()
	{
		activeScene = scenes.get(0);
		startTime = System.currentTimeMillis();
		setTitle(title); 
		setSize(Screen.width, Screen.height); 
		setResizable(false); 
		setDefaultCloseOperation(EXIT_ON_CLOSE); 
		setVisible(true); 

        insets = getInsets(); 
        setSize(insets.left + Screen.width + insets.right, insets.top + Screen.height + insets.bottom);
        new Input(this);
	}

	void update()
	{
		for(Iterator<GameObject> i = activeScene.gameObjects.iterator(); i.hasNext();)
		{
			i.next().update();
		}
	}

	void fixedUpdate()
	{
		for(Iterator<GameObject> i = activeScene.gameObjects.iterator(); i.hasNext();)
		{
			i.next().fixedUpdate();
		}
	}

	void draw()
	{
		Graphics g = getGraphics();
		activeScene.Draw(g, this);
	}

	public Scene getActiveScene()
	{
		return activeScene;
	}

	public void addScene(Scene scene)
	{
		scenes.add(scene);
	}
}