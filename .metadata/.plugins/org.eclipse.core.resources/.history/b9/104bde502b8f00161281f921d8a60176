package game.engine;

import java.awt.geom.*;

public class SquareCollider extends Collider 
{
	public Rect square;
	public Area area;
	
	public void start()
	{
		super.start();
		square = new Rect((int)gameObject.transform.position.x - (int)(gameObject.transform.scale.x * 16f),
				(int)gameObject.transform.position.y - (int)(gameObject.transform.scale.y * 16f),
				(int)(gameObject.transform.scale.x * 32f),
				(int)(gameObject.transform.scale.y * 32f));
	}
	
	public void collide()
	{
		for(int i = 0; i < Game.instance.activeScene.gameObjects.size(); i++)
		{
			SquareCollider c;
			
			if((c = Game.instance.activeScene.gameObjects.get(i).getComponent(SquareCollider.class)) != null)
			{
				if (c.gameObject == gameObject) continue;
				
				
				if (square.x < c.square.x + c.square.width &&
				   square.x + square.width > c.square.x &&
				   square.y < c.square.y + c.square.height &&
				   square.height + square.y > c.square.y) 
				{
					onCollisionStart((Collider)c);
				}
			}
		}
	}
	
	private boolean CheckInterSection(SquareCollider b)
	{
		AffineTransform af = new AffineTransform();
		af.rotate(Math.toRadians(gameObject.transform.rotation), gameObject.transform.position.x, gameObject.transform.position.y);
		area.createTransformedArea(af);
		
		AffineTransform bf = new AffineTransform();
		bf.rotate(Math.toRadians(b.gameObject.transform.rotation), b.gameObject.transform.position.x, b.gameObject.transform.position.y);
		b.area.createTransformedArea(bf);
		
		return area.intersects(b.area.getBounds()) && b.area.intersects(area.getBounds());
	}
	
	public void update()
	{
		super.update();
		square = new Rect((int)gameObject.transform.position.x - (int)(gameObject.transform.scale.x * 16f),
				(int)gameObject.transform.position.y - (int)(gameObject.transform.scale.y * 16f),
				(int)(gameObject.transform.scale.x * 32f),
				(int)(gameObject.transform.scale.y * 32f));
	}
	
	public void onCollisionStart(Collider col)
	{
		super.onCollisionStart(col);
		//System.out.println(gameObject.name + square.toString() + " collided with " + col.gameObject.name + ((SquareCollider)col).square.toString());
	}
}